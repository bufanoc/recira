/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.commonui.coreui.ItemListEditor"]){dojo._hasResource["nox.ext.apps.commonui.coreui.ItemListEditor"]=true;dojo.provide("nox.ext.apps.commonui.coreui.ItemListEditor");dojo.require("dojo.DeferredList");dojo.require("dijit.Dialog");dojo.require("dijit.form.Button");dojo.require("dijit.layout.BorderContainer");dojo.require("dojox.grid.DataGrid");dojo.require("dojox.grid.cells.dijit");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("dojox.dtl.html");dojo.declare("nox.ext.apps.commonui.coreui.ItemListEditor",dijit.Dialog,{templateString:"<div class=\"dijitDialog item-list-editor\" tabindex=\"-1\" waiRole=\"dialog\" waiState=\"labelledby-${id}_title\">\n\t<div dojoAttachPoint=\"titleBar\" class=\"dijitDialogTitleBar\">\n\t<span dojoAttachPoint=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\n\t<span dojoAttachPoint=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" dojoAttachEvent=\"onclick: onCancel\" title=\"${buttonCancel}\">\n\t\t<span dojoAttachPoint=\"closeText\" class=\"closeText\" title=\"${buttonCancel}\">x</span>\n\t</span>\n\t</div>\n\t<div dojoAttachPoint=\"containerNode\" class=\"dijitDialogPaneContent\">\n\t\t<div dojoAttachPoint=\"layoutContainer\" class=\"item-list-editor-layout\"\n\t\t\tdojoType=\"dijit.layout.BorderContainer\" design=\"headline\">\n\t\t\t<div dojoType=\"dijit.layout.BorderContainer\" class=\"item-list-editor-main-container\"\n\t\t\t\tdesign=\"sidebar\" region=\"center\">\n\t\t\t\t<div dojoAttachPoint=\"left\" region=\"left\" class=\"item-list-editor-left item-list-editor-list-container\"\n\t\t\t\t\tdojoType=\"dijit.layout.BorderContainer\" design=\"headline\">\n\t\t\t\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"top\" class=\"item-list-editor-list-header\">\n\t\t\t\t\t\tGroups\n\t\t\t\t\t</div>\n\t\t\t\t\t<!-- list goes here -->\n\t\t\t\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"bottom\" class=\"item-list-editor-list-footer\">\n\t\t\t\t\t\t<button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"addGroup\" dojoAttachEvent=\"onClick: onAddGroup\" iconClass=\"addGroup\"></button>\n\t\t\t\t\t\t<button dojoType=\"dijit.form.Button\" disabled=\"true\" dojoAttachPoint=\"editGroup\" dojoAttachEvent=\"onClick: onEditGroup\" iconClass=\"editGroup\"></button>\n\t\t\t\t\t\t<button dojoType=\"dijit.form.Button\" disabled=\"true\" dojoAttachPoint=\"remGroup\" dojoAttachEvent=\"onClick: onRemoveGroup\" iconClass=\"remGroup\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div dojoAttachPoint=\"center\" region=\"center\" class=\"item-list-editor-center\"\n\t\t\t\t\tdojoType=\"dijit.layout.ContentPane\">\n\t\t\t\t\t<button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"addOne\" dojoAttachEvent=\"onClick: onAddOne\">&gt;&gt;</button>\n\t\t\t\t\t<br/>\n\t\t\t\t\t<button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"remOne\" dojoAttachEvent=\"onClick: onRemOne\">&lt;&lt;</button>\n\t\t\t\t\t<hr/>\n\t\t\t\t\t<button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"addAll\" dojoAttachEvent=\"onClick: onAddAll\">All &gt;&gt;</button>\n\t\t\t\t\t<br/>\n\t\t\t\t\t<button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"remAll\" dojoAttachEvent=\"onClick: onRemAll\">&lt;&lt; All</button>\n\t\t\t\t</div>\n\t\t\t\t<div dojoAttachPoint=\"right\" region=\"right\" class=\"item-list-editor-right item-list-editor-list-container\"\n\t\t\t\t\tdojoType=\"dijit.layout.BorderContainer\" design=\"headline\">\n\t\t\t\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"top\" class=\"item-list-editor-list-header\">\n\t\t\t\t\t\tSelected\n\t\t\t\t\t</div>\n\t\t\t\t\t<!-- list goes here -->\n\t\t\t\t\t<!--<div dojoType=\"dijit.layout.ContentPane\" region=\"center\">\n\t\t\t\t\t\t<select multiple=\"true\" dojoAttachPoint=\"allGroups\" class=\"item-list-editor-list\">\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>-->\n\t\t\t\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"bottom\" class=\"item-list-editor-list-footer\">\n\t\t\t\t\t\t<input type=\"text\" dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"quickAddText\" dojoAttachEvent=\"onFocus: onQuickAddTextFocus, onBlur: onQuickAddTextBlur\" value=\"${quickAddDefaultText}\"/>\n\t\t\t\t\t\t<button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"quickAddButton\" dojoAttachEvent=\"onClick: onQuickAddClicked\" iconClass=\"addGroup\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div dojoType=\"dijit.layout.ContentPane\" class=\"item-list-editor-dialog-buttons-container\" region=\"bottom\">\n\t\t\t\t<hr/>\n\t\t\t\t<div class=\"item-list-editor-dialog-buttons\">\n\t\t\t\t\t<button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"cancelButton\" dojoAttachEvent=\"onClick: onCancel\" >Cancel</button>\n\t\t\t\t\t<button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"doneButton\" dojoAttachEvent=\"onClick: onExecute\">Done</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n",widgetsInTemplate:true,quickAddDefaultText:"Quick Add (comma separated)",layoutContainer:null,selectedStore:null,allStore:null,postCreate:function(){this.inherited(arguments);var d1=new dojo.Deferred();var d2=new dojo.Deferred();var dl=new dojo.DeferredList([d1,d2]);dl.addCallback(this,function(_4){var _5=_4[0][1];var _6=_4[1][1];var _7=function(_8){for(var i=0,j;j=_6[i];i++){if(j.getValue("name")==_8.getValue("name")){return true;}}return false;};var _b=[];for(var i=0,_d;_d=_5[i];i++){if(!_7(_d)){_b.push({name:_d.getValue("name"),displayName:_d.displayName()});}}this.tempAllStore=new dojo.data.ItemFileWriteStore({data:{items:_b}});var _e=[{name:"Groups",field:"displayName",width:"100%",editable:true,type:dojox.grid.cells._Widget}];var _f=this.leftGrid=new dojox.grid.DataGrid({store:this.tempAllStore,query:{},structure:_e,region:"center"});this.connect(_f.selection,"onChanged",function(){if(_f.edit.isEditing()){this.editGroup.attr("disabled",true);this.remGroup.attr("disabled",true);}else{var _10=_f.selection.getSelectedCount();this.editGroup.attr("disabled",(_10!=1));this.remGroup.attr("disabled",(_10<1));}});this.connect(_f.edit,"start",function(){this.addGroup.attr("disabled",true);this.editGroup.attr("disabled",true);this.remGroup.attr("disabled",true);});this.connect(_f.edit,"apply",function(){this.addGroup.attr("disabled",false);this.editGroup.attr("disabled",false);this.remGroup.attr("disabled",false);});this.connect(_f.edit,"cancel",function(){this.addGroup.attr("disabled",false);this.editGroup.attr("disabled",false);this.remGroup.attr("disabled",false);});this.left.addChild(_f);_f.startup();_b=[];for(var i=0,_d;_d=_6[i];i++){_b.push({name:_d.getValue("name"),displayName:_d.displayName()});}this.tempSelectedStore=new dojo.data.ItemFileWriteStore({data:{items:_b}});var _11=[{name:"Groups",field:"displayName",width:"100%"}];var _12=this.rightGrid=new dojox.grid.DataGrid({store:this.tempSelectedStore,query:{},structure:_11,region:"center"});this.right.addChild(_12);_12.startup();this.layoutContainer.resize();});this.allStore.fetch({query:{},onComplete:function(_13){d1.callback(_13);}});this.selectedStore.fetch({query:{},onComplete:function(_14){d2.callback(_14);}});},_moveItems:function(_15,_16,_17){var _18=_15.selection.getSelected();dojo.forEach(_18,function(_19){_17.newItem({name:_19.name,displayName:_19.displayName});_16.deleteItem(_19);});_17.save();_16.save();},_moveAll:function(_1a,_1b){_1a.fetch({query:{},onComplete:function(_1c){dojo.forEach(_1c,function(_1d){_1b.newItem({name:_1d.name,displayName:_1d.displayName});_1a.deleteItem(_1d);});_1b.save();_1a.save();}});},onAddOne:function(){this._moveItems(this.leftGrid,this.tempAllStore,this.tempSelectedStore);},onRemOne:function(){this._moveItems(this.rightGrid,this.tempSelectedStore,this.tempAllStore);},onAddAll:function(){this._moveAll(this.tempAllStore,this.tempSelectedStore);},onRemAll:function(){this._moveAll(this.tempSelectedStore,this.tempAllStore);},onAddGroup:function(){var _1e=this.tempAllStore.newItem({name:"New Item",displayName:"New Item"});var _1f=this.leftGrid.getItemIndex(_1e);this.leftGrid.edit.setEditCell(this.leftGrid.layout.cells[0],_1f);},onEditGroup:function(){var _20=this.leftGrid.selection.getSelected();var _21=this.leftGrid.getItemIndex(_20[0]);this.leftGrid.edit.setEditCell(this.leftGrid.layout.cells[0],_21);},onRemoveGroup:function(){dojo.forEach(this.leftGrid.selection.getSelected(),function(_22){this.tempAllStore.deleteItem(_22);},this);},onQuickAddTextFocus:function(){var _23=dojo.trim(this.quickAddText.attr("value"));if(_23==this.quickAddDefaultText){this.quickAddText.attr("value","");this.quickAddText.focus();}},onQuickAddTextBlur:function(){var _24=dojo.trim(this.quickAddText.attr("value"));if(_24==""){this.quickAddText.attr("value",this.quickAddDefaultText);}},onQuickAddClicked:function(){var _25=dojo.trim(this.quickAddText.attr("value"));if(_25!=this.quickAddDefaultText&&_25!=""){var _26=_25.split(/\s*,\s*/);for(var i=0,_28;_28=_26[i];i++){this.tempSelectedStore.newItem({name:_28,displayName:_28});}}},onDoneClicked:function(){this.hide();}});}