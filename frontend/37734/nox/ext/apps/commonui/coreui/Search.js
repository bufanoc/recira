/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.commonui.coreui.Search"]){dojo._hasResource["nox.ext.apps.commonui.coreui.Search"]=true;dojo.provide("nox.ext.apps.commonui.coreui.Search");dojo.require("dijit.Menu");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.Button");dojo.declare("nox.ext.apps.commonui.coreui.Search",[dijit._Widget,dijit._Templated],{templateString:"<form class=\"noxSearch\" dojoAttachPoint=\"containerNode\" dojoAttachEvent=\"onreset: onReset, onsubmit: onSubmit\"\n        action=\"${action}\" method=\"${method}\">\n    <div class=\"searchInput\">\n        <img src=\"${imageBasePathStr}/searchIcon.gif\").toString()} alt=\"Filter your Search\" class=\"searchIcon\"\n            dojoAttachPoint=\"changeFilterNode\" dojoAttachEvent=\"onclick: onChangeFilter\" />\n        <input type=\"text\" name=\"${search}\" dojoAttachPoint=\"searchString\" />\n        <img src=\"${imageBasePathStr}/searchClearIcon.gif\" alt=\"Clear your Search\" class=\"searchClear\"\n            dojoAttachEvent=\"onclick: onReset\" />\n        <input type=\"hidden\" name=\"${subset}\" dojoAttachPoint=\"subsetString\" />\n    </div>\n</form>\n",imageBasePathStr:dojo.moduleUrl("nox.ext.apps.commonui.coreui","images").toString(),widgetsInTemplate:true,search:"search",subset:"subset",action:"/Monitors/Search",method:"GET",prompt:"Search ",_fillContent:function(_1){this._source=_1;},startup:function(){if(this._started){return;}if(!this.dropDown){var _2=dojo.query("[widgetId]",this._source)[0];this.dropDown=dijit.byNode(_2);delete this._source;}dijit.popup.prepare(this.dropDown.domNode);this.reflectState(true);this.events=[dojo.connect(this.searchString,"onfocus",this,"onSearchFocus"),dojo.connect(this.searchString,"onblur",this,"onSearchBlur")];this.inherited(arguments);},destroyDescendants:function(){dojo.forEach(this.events,dojo.disconnect);if(this.dropDown){this.dropDown.destroyRecursive();delete this.dropDown;}this.inherited(arguments);},onBlur:function(){this._closeDropDown();this.inherited(arguments);},_toggleDropDown:function(){dijit.focus(this.changeFilterNode);if(!this.dropDown){return;}this[this._opened?"_closeDropDown":"_openDropDown"]();},_openDropDown:function(){if(this._opened){return;}this._opened=dojo.map(this.dropDown.getDescendants(),function(x){return x.checked;});dijit.popup.open({parent:this,popup:this.dropDown,around:this.changeFilterNode,orient:this.isLeftToRight()?{"BL":"TL","BR":"TR","TL":"BL","TR":"BR"}:{"BR":"TR","BL":"TL","TR":"BR","TL":"BL"},onExecute:dojo.hitch(this,"onExecute"),onCancel:dojo.hitch(this,"_closeDropDown"),onClose:dojo.hitch(this,function(){this._opened=null;})});if(typeof this.dropDown.focus=="function"){this.dropDown.focus();}},_closeDropDown:function(){if(this._opened){dijit.popup.close(this.dropDown);this._opened=null;}},reflectState:function(_4){this.isEmpty=_4;if(_4){dojo.addClass(this.domNode,"empty");dojo.some(this.dropDown.getDescendants(),function(_5){if(_5.attr("checked")){this.searchString.value=this.prompt+_5.attr("label");return true;}return false;},this);}else{dojo.removeClass(this.domNode,"empty");this.searchString.value="";}},onExecute:function(){var _6=this.dropDown.getDescendants(),_7,_8=dojo.map(_6,function(_9,i){return _9.attr("checked")^this._opened[i];},this);dojo.forEach(_6,function(_b,i){_b.attr("checked",_8[i]);if(_8[i]){_7=_b.attr("label");}});this._closeDropDown();if(this.isEmpty){this.searchString.value=this.prompt+_7;}},onChangeFilter:function(){this._toggleDropDown();},onSearchFocus:function(){if(this.isEmpty){this.reflectState(false);}},onSearchBlur:function(){if(this.searchString.value){this.isEmpty=false;}else{this.reflectState(true);}},onReset:function(){this.reflectState(true);},onSubmit:function(){if(this.isEmpty){this.searchString.value="";}var _d=this.dropDown.getDescendants(),_e;dojo.some(_d,function(_f){if(_f.attr("checked")){this.subsetString.value=_f.attr("label");return true;}return false;},this);return true;},submit:function(){if(!(this.onSubmit()===false)){this.containerNode.submit();}}});}