/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.commonui.coreui._UpdatingBarGraph"]){dojo._hasResource["nox.ext.apps.commonui.coreui._UpdatingBarGraph"]=true;dojo.provide("nox.ext.apps.commonui.coreui._UpdatingBarGraph");dojo.require("dojox.charting.Chart2D");dojo.require("dojox.charting.themes.Grasshopper");dojo.require("dojox.charting.action2d.Tooltip");dojo.require("nox.ext.apps.commonui.directory.Location");dmws=nox.ext.apps.commonui.directory;coreui=nox.ext.apps.commonui.coreui;var _get_tooltip=function(o){if(o==null){return;}var t=o.run,_3="";if(t&&typeof t=="object"&&t.tooltip){_3=t.tooltip;}return _3+(_3?"<br>":"")+"Click for more info";};dojo.declare("_Link",dojox.charting.action2d.Base,{constructor:function(){this.connect();},process:function(o){if(o.type==="onclick"&&o.run&&o.run.url){document.location=o.run.url;}}});dojo.declare("nox.ext.apps.commonui.coreui._UpdatingBarGraph",[],{_chart:null,_domNode:null,_graph_size:5,_last_response:[],x_axis_label:"",constructor:function(_5,_6){this._domNode=_5;if(_6.url!=null){this._url=_6.url;}coreui.getUpdateMgr().xhrGet({url:this._url,load:dojo.hitch(this,"_handle_new_response"),error:dojo.hitch(this,function(_7,_8){this._set_err_msg("Error Fetching Data");console_log("Error fetching chart data from for "+this._url+" : ",_7,_8);}),timeout:this.timeout,handleAs:"json",recur:true});},_get_graph_items:function(_9){throw Error("Child class must implement _get_graph_items");},_set_err_msg:function(_a){coreui.base.remove_all_children(this._domNode);var _b=document.createElement("p");dojo.addClass(_b,"chart-error-msg");_b.innerHTML=_a;this._domNode.appendChild(_b);var _c=dojo.byId("chart_x_axis_label");if(_c!=null){_c.innerHTML="";}},_handle_new_response:function(_d,_e){this._last_response=_d;to_graph=this._get_graph_items(_d);coreui.base.remove_all_children(this._domNode);if(this._chart!=null){this._chart.destroy();this._chart=null;}if(to_graph.length==0){this._set_err_msg("No Data Available");return;}var _f=dojo.byId("chart_x_axis_label");if(_f!=null&&_f.innerHTML==""&&this.x_axis_label!=null){_f.innerHTML="<center><b>"+this.x_axis_label+"</b></center>";}var _10=[];for(var i=1;i<=this._graph_size;i++){var _12=this._graph_size-i;if(_12<to_graph.length){txt=to_graph[_12].label_text;}else{txt="";}_10.push({value:i,text:txt});}this._chart=new dojox.charting.Chart2D(this._domNode);this._chart.setTheme(dojox.charting.themes.Grasshopper);this._chart.addAxis("x",{fixLower:"major",fixUpper:"major",includeZero:true,htmlLabels:false});this._chart.addAxis("y",{vertical:true,fixLower:"minor",fixUpper:"minor",natural:true,htmlLabels:false,labels:_10});this._chart.addPlot("default",{type:"Bars",gap:4});var _13=[];for(var i=0;i<this._graph_size;i++){_13.push(0);}for(var i=this._graph_size;i>=1;i--){var _12=this._graph_size-i;var _14=dojo.clone(_13);if(_12<to_graph.length){_14[i-1]=to_graph[_12].value;this._chart.addSeries("Series "+i,_14,{tooltip:to_graph[_12].tooltip,url:to_graph[_12].link});var _15=new dojox.charting.action2d.Tooltip(this._chart,"default",{text:_get_tooltip});var _16=new _Link(this._chart);}}this._chart.render();},setVisible:function(_17){var d=_17?"block":"none";dojo.style(this._domNode,{display:d});if(this._last_response!=null){this._handle_new_response(this._last_response);}}});}