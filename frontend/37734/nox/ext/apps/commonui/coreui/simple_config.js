/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.commonui.coreui.simple_config"]){dojo._hasResource["nox.ext.apps.commonui.coreui.simple_config"]=true;dojo.provide("nox.ext.apps.commonui.coreui.simple_config");dojo.require("dojo.io.iframe");dojo.require("nox.ext.apps.commonui.coreui.UpdateMgr");dojo.require("nox.ext.apps.commonui.coreui.UpdateErrorHandler");coreui=nox.ext.apps.commonui.coreui;dojo.declare("nox.ext.apps.commonui.coreui.simple_config",[],{_put_error_handlers:{401:function(_1,_2,_3,_4){coreui.UpdateErrorHandler.showError("You are not currently logged in. "+" Log in via another browser window "+" to avoid losing unsaved changes on the current page.",{header_msg:"Updating Configuration Failed:"});},400:function(_5,_6,_7,_8){coreui.UpdateErrorHandler.showError(_5.responseText,{header_msg:"Updating Configuration Failed: Bad Request:"});},500:function(_9,_a,_b,_c){coreui.UpdateErrorHandler.showError(_9.responseText,{header_msg:"Updating Configuration Failed: Server Error:"});}},_get_error_handlers:{400:function(_d,_e,_f,_10){coreui.UpdateErrorHandler.showError(_d.responseText,{header_msg:"Retrieving Configuration Data Failed: Bad Request:"});},500:function(_11,_12,_13,_14){coreui.UpdateErrorHandler.showError(_11.responseText,{header_msg:"Retrieving Configuration Data Failed: Server Error:"});}},formToObject:function(_15){var f=dojo.formToObject(_15);var _17="#"+_15+" input[type='checkbox']";dojo.forEach(dojo.query(_17),function(x){if(x.checked){f[x.name]=1;}else{f[x.name]=0;}});_17="#"+_15+" input[type='integer']";dojo.forEach(dojo.query(_17),function(x){f[x.name]=parseInt(f[x.name]);});return f;},submit_form:function(_1a){this.submit_form_with_callback(_1a,null);},submit_form_with_callback:function(_1b,_1c){var f=this.formToObject(_1b);if(!f["section_id"]){console_log("Error, form must have element with id 'section_id'");return;}var _1e=f["section_id"];delete f.section_id;for(key in f){if(key.indexOf("ignore_")==0){delete f[key];}}this.submit_config(_1e,f,_1c);},submit_config:function(_1f,_20,_21){var _22={url:"/ws.v1/config/"+_1f,headers:{"content-type":"application/json"},putData:dojo.toJson(_20),load:dojo.hitch(this,function(){this._signal_update_success("Update Successful");if(_21){_21(arguments);}}),timeout:1000000,errorHandlers:this._put_error_handlers};this._set_status_text("Update in Progress...");nox.ext.apps.commonui.coreui.getUpdateMgr().rawXhrPut(_22);},submit_file_form:function(_23,cb){var f=this.formToObject(_23);if(!f["section_id"]){console_log("Error, form must have element with id 'section_id'");return;}var _26=f["section_id"];delete f.section_id;dojo.io.iframe.send({form:_23,contentType:"multipart/form-data",handleAs:"html",url:"/ws.v1/config_base64/"+_26,load:function(_27,_28){if(cb!=null){cb();}return _27;},errorHandlers:this._put_error_handlers});},_checkbox_value:function(key,_2a){if(_2a==1){return true;}if(_2a!=0){console_log("error, field '"+key+"' should"+" be either 0 or 1");}return false;},clear_form:function(_2b){var _2c=dojo.byId(_2b);for(key in _2c){if(!_2c[key]){continue;}var _2d=_2c[key].type;if(!_2d){continue;}if(_2d=="text"){_2c[key].value="";}else{if(_2d=="checkbox"){_2c[key].checked=false;}else{if(_2d=="select-one"){_2c[key].selectedIndex=-1;}}}}},fill_form:function(_2e,_2f){var _30=dojo.byId(_2f);this.clear_form(_2f);for(key in _2e){if(!_30[key]){console_log("form has no field with name "+key);continue;}var _31=_2e[key];var _32=_30[key].type;if(_32=="text"||_32=="textarea"||_32=="hidden"){_30[key].value=_31;}else{if(_32=="checkbox"){_30[key].checked=this._checkbox_value(key,_31);}else{if(_32=="select-one"){for(i=0;i<_30[key].options.length;i++){var op=_30[key].options[i].innerHTML;var _34=op.replace(/^\s+|\s+$/g,"");if(_34==_31){_30[key].selectedIndex=i;break;}}}else{console_log("element has unknown type '"+_32+"'");}}}}},fill_form_from_config:function(_35,cb){var _37=dojo.byId(_35);var _38=_37["section_id"].value;var _39=dojo.hitch(this,function(_3a,_3b){this.fill_form(_3a,_35);cb();});this.get_config_as_object(_38,_39);},get_config_as_object:function(_3c,cb){this._set_status_text("Loading Configuration Data...");nox.ext.apps.commonui.coreui.getUpdateMgr().xhrGet({url:"/ws.v1/config/"+_3c,load:dojo.hitch(this,function(_3e,_3f){this._signal_update_success("Data Successfully Loaded");cb(_3e);}),timeout:1000000,handleAs:"json",errorHandlers:this._get_error_handlers});},_set_status_text:function(msg){var _41=dojo.byId("simple_config_status");if(_41!=null){_41.innerHTML=msg;}},_signal_update_success:function(msg){var _43=dojo.byId("simple_config_status");if(_43!=null){_43.style.opacity=1;_43.innerHTML="<span><font color='green'>"+msg+"</font></span>";var _44=dojo.fadeOut({node:_43,duration:5000});_44.play();}}});(function(){var _45=null;nox.ext.apps.commonui.coreui.getSimpleConfig=function(){if(_45==null){_45=new nox.ext.apps.commonui.coreui.simple_config();}return _45;};})();}