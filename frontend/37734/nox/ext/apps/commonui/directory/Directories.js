/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.commonui.directory.Directories"]){dojo._hasResource["nox.ext.apps.commonui.directory.Directories"]=true;dojo.provide("nox.ext.apps.commonui.directory.Directories");dojo.require("nox.ext.apps.commonui.coreui.UpdateMgr");dojo.require("nox.ext.apps.commonui.directory.DirectoryStore");(function(){var _1=nox.ext.apps.commonui.directory;var d=_1.Directories;principal_types=["user","host","switch","location"];d.primary={user:null,host:null,"switch":null,location:null};d.read_default={user:null,host:null,"switch":null,location:null};d.num_read={user:0,host:0,"switch":0,location:0};d.write_default={user:null,host:null,"switch":null,location:null};d.num_write={user:0,host:0,"switch":0,location:0};function _3(){dojo.forEach(principal_types,function(_4){d.primary[_4]=null;d.read_default[_4]=null;d.write_default[_4]=null;var a={query:{},sort:[{attribute:"search_order"}],onComplete:function(_6){d.num_read[_4]=_6.length;if(_6.length<=0){return;}var _7=d.datastore.getValue(_6[0],"name");d.read_default[_4]=_7;if(_6.length==1){d.primary[_4]=_7;}},onError:function(_8){console_log("Error occured in nox.ext.apps.commonui.directory.Directories._determine_primaries_and_defaults() while attempting read fetch.");}};a.query["read_"+_4+"_enabled"]=true;d.datastore.fetch(a);a={query:{},sort:[{attribute:"search_order"}],onComplete:function(_9){d.num_write[_4]=_9.length;if(_9.length<=0){return;}var _a=d.datastore.getValue(_9[0],"name");d.write_default[_4]=_a;},onError:function(_b){console_log("Error occured in nox.ext.apps.commonui.directory.Directories._determine_primaries_and_defaults() while attempting write fetch.");}};a.query["write_"+_4+"_enabled"]=true;d.datastore.fetch(a);dojo.publish("update_completions",["nox.ext.apps.commonui.directory.Directories"]);});};d.page_init=function(){d.datastore=new _1.DirectoryStore({url:"/ws.v1/directory/instance"});d.datastore.update({onComplete:function(){_3();dojo.connect(d.datastore,"onNew",_3);dojo.connect(d.datastore,"onDelete",_3);}});};})();dojo.addOnLoad(nox.ext.apps.commonui.directory.Directories.page_init);}