/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.commonui.directory.GroupModifyDialog"]){dojo._hasResource["nox.ext.apps.commonui.directory.GroupModifyDialog"]=true;dojo.provide("nox.ext.apps.commonui.directory.GroupModifyDialog");dojo.require("dijit._Widget");dojo.require("dijit.Dialog");dojo.require("dijit._Templated");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("nox.ext.apps.commonui.directory.Directories");var coreui=nox.ext.apps.commonui.coreui;var dmws=nox.ext.apps.commonui.directory;dojo.declare("nox.ext.apps.commonui.directory.GroupModifyDialog",[dijit._Widget,dijit._Templated],{templateString:"<div dojoType=\"dijit.layout.ContentPane\" dojoAttachPoint=\"content\" > \n  <div dojoType=\"dijit.Dialog\" dojoAttachPoint=\"main_dialog\" title=\"${title}\"> \n        <table> \n          <tr> <td> Directory:\n           <span dojoType=\"dijit.layout.ContentPane\" dojoAttachPoint=\"dir_div\"> \n           </span> \n        </td></tr> \n        <tr> <td> Name:\n        <input dojoType=\"dijit.form.TextBox\" type=\"text\" trim=\"true\" dojoAttachPoint=\"name\"/>\n        </td> </tr> \n        <tr><td> \n    <button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"addBtn\">Add</button>\n    <button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"cancelBtn\">Cancel</button>\n        </td></tr>\n        </table> \n      </div>\n</div> \n",widgetsInTemplate:true,group:null,type:null,title:null,ctor:null,principal_type:null,onChange:function(){},_set_widget_values:function(){if(!this.group){return;}var _1=this.group.directoryName();if(_1!="discovered"){this.directory.setDisplayedValue(_1);}},_cancel:function(){this.main_dialog.hide();},_done:function(){var g=new this.ctor({});if(!g.check_name(this.name.getValue())){coreui.UpdateErrorHandler.showError("'"+this.name.getValue()+"' is an invalid name",{header_msg:"Operation Failed:",hide_retry:true,validation_error:true});return;}if(!g.check_name(this.directory.getValue())){coreui.UpdateErrorHandler.showError("'"+this.directory.getValue()+"' is an invalid directory "+"name",{header_msg:"Operation Failed:",hide_retry:true,validation_error:true});return;}if(!this.directory.validate()){this.directory._hasBeenBlurred=true;this.directory.focus();return;}this.main_dialog.hide();this.group_name=this.name.getValue();this.group_directory=this.directory.getValue();args={name:this.group_name,directory:this.group_directory,ctor:this.ctor,principal_type:this.principal_type};if(this.type=="parent"){this.group.modify_parent("PUT",args);}else{if(this.type=="subgroup"){this.group.modify_subgroup("PUT",args);}else{if(this.type=="member"){this.group.modify_direct_member("PUT",args);}else{if(this.type=="group"){var _3=this.group_directory+";"+this.group_name;this.group=new this.ctor({initialData:{name:_3}});this.group.create(function(e){window.location.pathname=window.location.pathname.replace(/Groups$/,"GroupInfo?name="+encodeURIComponent(_3));});}else{throw "unknown group modify type '"+type+"'";}}}}this.onChange(this.group);},show:function(){this.main_dialog.show();this.name.focus();},_name_keypress:function(_5){switch(_5.keyCode){case dojo.keys.ENTER:this._done();break;}},postCreate:function(){this.inherited(arguments);this.main_dialog.closeButtonNode.style.display="none";if(this.type=="parent"||this.type=="group"){var _6="write_"+this.principal_type+"_enabled";}else{if(this.type=="subgroup"){var _6="read_"+this.principal_type+"_enabled";}else{var _6="read_"+this.principal_type+"_enabled";}}var _7={};_7[_6]=true;this.directory=new dijit.form.FilteringSelect({store:dmws.Directories.datastore,searchAttr:"name",query:_7});this.dir_div.domNode.appendChild(this.directory.domNode);this._set_widget_values();var d=this.directory;dmws.Directories.datastore.fetch({onComplete:function(_9){if(_9.length==2){dojo.forEach(_9,function(_a){if(_a.displayName()!="discovered"){d.setDisplayedValue(_a.displayName());}});}}});dojo.connect(this.name.domNode,"onkeypress",this,"_name_keypress");dojo.connect(this.addBtn,"onClick",this,"_done");dojo.connect(this.cancelBtn,"onClick",this,"_cancel");}});}