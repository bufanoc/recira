/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.commonui.directory.PrincipalListFilter"]){dojo._hasResource["nox.ext.apps.commonui.directory.PrincipalListFilter"]=true;dojo.provide("nox.ext.apps.commonui.directory.PrincipalListFilter");dojo.require("nox.ext.apps.commonui.coreui.ListTableHelper");dojo.require("nox.ext.apps.commonui.directory.Host");dojo.require("nox.ext.apps.commonui.directory.Switch");dojo.require("nox.ext.apps.commonui.directory.User");dojo.require("nox.ext.apps.commonui.directory.Location");(function(){var _1=nox.ext.apps.commonui.directory;var _2=nox.ext.apps.commonui.coreui;var u=nox.ext.apps.commonui.directory.PrincipalListFilter;var _4={"host":_1.Host,"user":_1.User,"switch":_1.Switch,"location":_1.Location};u.init_principal_list_page=function(_5){var _6=_4[_5];u.setup_simple_listpage_edit_hooks(_5,_6);return new nox.ext.apps.commonui.coreui.ListTableHelper({filters:[{id:"filter_name",urlParam:"name_glob"},{id:"filter_directory",urlParam:"directory"},{id:"filter_active",urlParam:"active"},{id:"filter_start",urlParam:"start"},{id:"filter_count",urlParam:"count"},{id:"filter_sort_attr",urlParam:"sort_attr"},{id:"filter_sort_desc",urlParam:"sort_desc"},{id:"filter_ip",urlParam:"nwaddr_glob"},{id:"filter_mac",urlParam:"dladdr_glob"},{id:"filter_loc",urlParam:"location_name_glob"},{id:"filter_switch_name",urlParam:"switch_name"},{id:"filter_port_name",urlParam:"port_name"}],dir_boxes:[{id:"filter_directory",query:"read_"+_5+"_enabled"}]});};function _7(){var _8=[];var _9=dojo.query(".select-box");_9.forEach(function(_a){if(_a.checked){_8.push(_a.id);}});return _8;};u.setup_simple_listpage_edit_hooks=function(_b,_c){var _d=dijit.byId("add_principal_button");if(_d!=null){dojo.connect(_d,"onClick",function(){var _e="Add "+_b.substring(0,1).toUpperCase()+_b.substring(1)+" Principal";var _f=_1.getPrincipalUtil().show_modify_dialog(_b,null,_e,_c);});}var _10=dijit.byId("remove_principal_button");if(_10!=null){dojo.connect(_10,"onClick",function(){var _11=_7();for(var i=0;i<_11.length;i++){var _13=_11[i];var _14=_13.split(";")[0];var q={name:_14};q["write_"+_b+"_enabled"]=true;var _16=false;var _17=i==(_11.length-1);var _18=dojo.hitch(this,function(_19){if(_16){var p=new _c({initialData:{name:_13}});p.deleteOnServer({onComplete:function(){if(_19){document.location=document.location;}}});}else{_2.UpdateErrorHandler.showError("Cannot remove a "+_b+" from read-only directory '"+_14+"'",{header_msg:"Removal Failed:",hide_retry:true,validation_error:true});}},_17);_1.Directories.datastore.fetch({query:q,onItem:function(_1b){_16=true;},onComplete:_18});}});}};u.setup_simple_listpage_button_action=function(_1c,_1d,_1e,_1f){var btn=dijit.byId(_1c);if(btn!=null){dojo.connect(btn,"onClick",function(){var _21=_7();for(var i=0;i<_21.length;i++){var _23=i==(_21.length-1);var p=new _1d({initialData:{name:_21[i]}});p[_1e](dojo.hitch(this,function(_25,_26){if(_25&&_1f!=null){_1f();}},_23));}});}};u.setup_simple_listpage_deauth_hooks=function(_27){u.setup_simple_listpage_button_action("deauth_principal_button",_27,"delete_binding",function(){document.location=document.location;});};u.setup_switch_registration_hooks=function(){var _28=dijit.byId("regSwitchButton");dojo.connect(_28,"onClick",function(){var _29=_7();var _2a=[];for(var i=0;i<_29.length;i++){var s=new _1.Switch({initialData:{name:_29[i]},updateList:["approval"]});_2a.push(s);}_1.getSwitchUtil().register_switch(_2a,function(){document.location=document.location;});});var _2d=dijit.byId("deregSwitchButton");dojo.connect(_2d,"onClick",function(){var _2e=_7();for(var i=0;i<_2e.length;i++){var _30=i==(_2e.length-1);var p=new _1.Switch({initialData:{name:_2e[i]},updateList:["approval"]});p.update({onComplete:function(){p.set_approval(false,dojo.hitch(this,function(_32,_33){if(_32){document.location=document.location;}},_30));}});}});};})();}