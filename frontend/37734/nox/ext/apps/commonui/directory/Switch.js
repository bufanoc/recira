/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.commonui.directory.Switch"]){dojo._hasResource["nox.ext.apps.commonui.directory.Switch"]=true;dojo.provide("nox.ext.apps.commonui.directory.Switch");dojo.require("nox.ext.apps.commonui.directory.Directories");dojo.require("nox.ext.apps.commonui.directory._Principal");dojo.require("nox.ext.apps.commonui.directory.SwitchPortStore");dojo.require("nox.ext.apps.commonui.directory.SwitchGroupStore");dojo.require("nox.ext.apps.commonui.coreui.UpdateMgr");dojo.require("dijit.form.FilteringSelect");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dijit.Dialog");dojo.require("nox.ext.apps.commonui.switch_approval.SwitchApprover");dojo.declare("nox.ext.apps.commonui.directory.Switch",[nox.ext.apps.commonui.directory._Principal],{constructor:function(_1){dojo.mixin(this.updateTypes,{"config":{load:dojo.hitch(this,"updateConfig")},"stat":{load:dojo.hitch(this,"updateStat")},"approval":{load:dojo.hitch(this,"updateApproval")},"info":{load:dojo.hitch(this,"updateInfo")},"desc":{load:dojo.hitch(this,"updateDesc")}});},wsv1Path:function(){if(this.isNull()){return null;}return "/ws.v1/switch/"+encodeURIComponent(this.directoryName())+"/"+encodeURIComponent(this.principalName());},uiMonitorPath:function(){if(this.isNull()){return null;}return "/Monitors/Switches/SwitchInfo?name="+encodeURIComponent(this.getValue("name"));},updateInfo:function(){return this._xhrGetMixin("info",this.wsv1Path(),function(r){return {dpid:r.dpid};});},updateConfig:function(){return this._xhrGetMixin("config",this.wsv1Path()+"/config");},updateDesc:function(){return this._xhrGetMixin("desc",this.wsv1Path()+"/desc");},updateStat:function(){return this._xhrGetMixin("stat",this.wsv1Path()+"/stat");},updateApproval:function(){return this._xhrGetMixin("approval",this.wsv1Path()+"/approval");},portStore:function(_3){return new this.dmws.SwitchPortStore(dojo.mixin(_3,{"url":this.wsv1Path()+"/port","switchObj":this}));},groupStore:function(_4){return new this.dmws.SwitchGroupStore(dojo.mixin(_4,{url:this.wsv1Path()+"/group"}));},set_approval:function(_5,_6){var _7=nox.ext.apps.commonui.coreui.getUpdateMgr();var _8=this.wsv1Path()+"/approval?approved="+_5;_7.rawXhrPut({handleAs:"json",url:_8,headers:{"content-type":"application/json"},putData:{},timeout:5000,load:dojo.hitch(this,function(_9,_a){nox.ext.apps.commonui.coreui.getUpdateMgr().updateNow();if(_6!=null){_6(this);}return null;})});},is_registered:function(){var _b=false;if(this._data.fp_credentials){dojo.forEach(this._data.fp_credentials,function(_c){if(_c.is_approved){_b=true;}});}return _b;},get_fingerprint:function(){if(this._data.fp_credentials&&this._data.fp_credentials.length>0){return this._data.fp_credentials[0].fingerprint;}return "";}});dojo.declare("nox.ext.apps.commonui.directory.SwitchUtil",[],{register_switch:function(_d,_e){if(_d.length==0){coreui.UpdateErrorHandler.showError("Must select a switch to register.",{hide_retry:true,header_msg:"Invalid Operation:",validation_error:true});return;}if(_d.length>1){coreui.UpdateErrorHandler.showError("Cannot register multiple switches simultaneously.",{hide_retry:true,header_msg:"Invalid Operation:",validation_error:true});return;}var _f=_d[0];_f.update({onComplete:dojo.hitch(this,function(){this.show_switch_reg_dialog(_f,{load_new_switch_page:false,onComplete:_e});})});},show_switch_reg_dialog:function(_10,_11){if(_10.is_registered()){coreui.UpdateErrorHandler.showError("You must deregister the switch, then register it again.",{hide_retry:true,header_msg:"Switch Already Registered:",validation_error:true});return;}var _12=dijit.byId("approve_id");if(_12){_12.destroy();}if(_11==null){_11={};}_11.id="approve_id";_11.switch_obj=_10;_12=new nox.ext.apps.commonui.switch_approval.SwitchApprover(_11);dojo.body().appendChild(_12.domNode);_12.startup();},get_status_cell:function(){var _13={name:"status",header:"Status",get:function(_14){var s=document.createElement("span");var txt=_14.getValue("status");s.className="errormsg";if(txt!="inactive"){s.className="successmsg";}s.appendChild(document.createTextNode(txt));return s;}};return _13;}});(function(){var _17=null;nox.ext.apps.commonui.directory.getSwitchUtil=function(){if(_17==null){_17=new nox.ext.apps.commonui.directory.SwitchUtil();}return _17;};})();}