/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.commonui.directory.User"]){dojo._hasResource["nox.ext.apps.commonui.directory.User"]=true;dojo.provide("nox.ext.apps.commonui.directory.User");dojo.require("nox.ext.apps.commonui.coreui.base");dojo.require("nox.ext.apps.commonui.directory.Directories");dojo.require("nox.ext.apps.commonui.directory._Principal");dojo.require("nox.ext.apps.commonui.directory._PrincipalStore");var AUTH_SIMPLE="simple_auth";dojo.declare("nox.ext.apps.commonui.directory.User",[nox.ext.apps.commonui.directory._Principal],{constructor:function(_1){dojo.mixin(this.updateTypes,{"info":{load:dojo.hitch(this,"updateInfo")},"cred":{load:dojo.hitch(this,"updateCred")}});dojo.mixin(this.derivedAttributes,{"passwd_set":{get:dojo.hitch(this,"passwd_set")}});},wsv1Path:function(){if(this.isNull()){return null;}return "/ws.v1/user/"+encodeURIComponent(this.directoryName())+"/"+encodeURIComponent(this.principalName());},uiMonitorPath:function(){if(this.isNull()){return null;}return "/Monitors/Users/UserInfo?name="+encodeURIComponent(this._data.name);},passwd_set:function(){if(this._data.cred!=null&&this._data.cred[AUTH_SIMPLE]!=null){return "Yes";}return "No";},updateInfo:function(_2){return this._xhrGetMixin("info",this.wsv1Path());},updateCred:function(_3){return this._xhrGetMixin("cred",this.wsv1Path()+"/cred",function(_4){return {"cred":_4};});},hostStore:function(_5){return new this.dmws.HostStore(dojo.mixin(_5,{"url":this.wsv1Path()+"/active/host","userObj":this}));},groupStore:function(_6){return new this.dmws.UserGroupStore(dojo.mixin(_6,{"url":this.wsv1Path()+"/group","userObj":this}));},save:function(_7){var _8={name:this._data.name};if(this._data.user_id!=null){_8["user_id"]=this._data.user_id;}if(this._data.user_real_name!=null){_8["user_real_name"]=this._data.user_real_name;}if(this._data.description!=null){_8["description"]=this._data.description;}if(this._data.phone!=null){_8["phone"]=this._data.phone;}if(this._data.user_email!=null){_8["user_email"]=this._data.user_email;}if(this._data.location!=null){_8["location"]=this._data.location;}var _9;if(_7!=null&&_7["errorHandlers"]!=null){_9=_7["errorHandlers"];}else{_9={400:function(_a,_b,_c,_d){nox.ext.apps.commonui.coreui.UpdateErrorHandler.showError(_a.responseText,{header_msg:"Save failed"});}};}nox.ext.apps.commonui.coreui.getUpdateMgr().rawXhrPut({url:this.wsv1Path(),headers:{"content-type":"application/json"},putData:dojo.toJson(_8),timeout:30000,errorHandlers:_9});},saveCred:function(_e,_f){var _10;if(_f!=null&&_f["errorHandlers"]!=null){_10=_f["errorHandlers"];}else{_10={400:function(_11,_12,_13,_14){nox.ext.apps.commonui.coreui.UpdateErrorHandler.showError(_11.responseText,{auto_show:true,header_msg:"Save credentials failed."});}};}var _15={};if(_e!=null){_15[AUTH_SIMPLE]=[{password:_e}];}nox.ext.apps.commonui.coreui.getUpdateMgr().rawXhrPut({url:this.wsv1Path()+"/cred",headers:{"content-type":"application/json"},putData:dojo.toJson(_15),timeout:30000,errorHandlers:_10});this._updateBasicData({"cred":_15});}});}