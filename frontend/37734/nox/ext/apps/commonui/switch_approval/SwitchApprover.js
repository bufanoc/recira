/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.commonui.switch_approval.SwitchApprover"]){dojo._hasResource["nox.ext.apps.commonui.switch_approval.SwitchApprover"]=true;dojo.provide("nox.ext.apps.commonui.switch_approval.SwitchApprover");dojo.require("dijit._Widget");dojo.require("dijit.Dialog");dojo.require("dijit._Templated");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.CheckBox");dojo.require("dijit.form.Button");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.Textarea");dojo.require("dijit.form.SimpleTextarea");dojo.require("nox.ext.apps.commonui.directory.Directories");dmws=nox.ext.apps.commonui.directory;dojo.declare("nox.ext.apps.commonui.switch_approval.SwitchApprover",[dijit._Widget,dijit._Templated],{templateString:"<div dojoAttachPoint=\"content\">\n  <div dojoType=\"dijit.Dialog\" dojoAttachPoint=\"main_dialog\" \n        title=\"Register Switch\">\n  <form dojoType=\"dijit.form.Form\">\n    <div dojoAttachPoint=\"register_msg\">  </div> \n    <table> \n    <tr> \n      <td> <b> Directory:</b>  </td> \n      <td>\n        <span dojoType=\"dijit.layout.ContentPane\" dojoAttachPoint=\"dir_div\"> \n        </span> \n  </td> \n</tr> \n    <tr> \n      <td> <b> Switch Name:</b> </td> \n      <td> <input type=\"text\" dojoType=\"dijit.form.TextBox\"\n            trim=\"true\" dojoAttachPoint=\"name\"/>\n      </td> \n    </tr> \n</table> \n    <div class=\"rule-buttons\">\n    <button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"registerBtn\">Register</button>\n    <button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"cancelBtn\">Cancel</button>\n    </div>\n  </form>\n</div> \n</div>\n",widgetsInTemplate:true,onComplete:null,load_new_switch_page:false,switch_obj:null,_set_widget_values:function(){var fp=this.switch_obj.get_fingerprint();if(fp==""){msg="Warning: No SSL fingerprint known for this switch. Register insecure switch?";}else{msg="Register switch with SSL fingerprint '"+fp+"' ?";}this.register_msg.innerHTML=msg;this.name.setValue(this.switch_obj.principalName());var _2=this.switch_obj.directoryName();if(_2!="discovered"){this.directory.setDisplayedValue(_2);}},_cancel:function(){this.main_dialog.hide();},_done:function(){if(!this.directory.validate()){this.directory._hasBeenBlurred=true;this.directory.focus();return;}this.main_dialog.hide();this.switch_name=this.name.getValue();this.switch_directory=this.directory.getValue();var _3=dojo.hitch(this,function(){var _4=this.switch_directory+";"+this.switch_name;var _5=new dmws.Switch({initialData:{name:_4}});var cb=dojo.hitch(this,function(sw){if(this.onComplete!=null){this.onComplete();}if(this.load_new_switch_page){document.location=sw.uiMonitorPath();}});_5.set_approval(true,cb);});this.switch_obj.full_rename({directory:this.switch_directory,name:this.switch_name,onComplete:_3});},startup:function(){this.inherited("startup",arguments);this.directory=new dijit.form.FilteringSelect({store:dmws.Directories.datastore,searchAttr:"name",query:{write_switch_enabled:true}});this.dir_div.domNode.appendChild(this.directory.domNode);this._set_widget_values();this.main_dialog.closeButtonNode.style.display="none";this.main_dialog.show();this.directory.focus();dojo.connect(this.registerBtn,"onClick",this,"_done");dojo.connect(this.cancelBtn,"onClick",this,"_cancel");}});}