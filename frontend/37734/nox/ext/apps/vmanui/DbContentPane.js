/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.vmanui.DbContentPane"]){dojo._hasResource["nox.ext.apps.vmanui.DbContentPane"]=true;dojo.provide("nox.ext.apps.vmanui.DbContentPane");dojo.require("dijit.layout.ContentPane");dojo.declare("nox.ext.apps.vmanui.DbContentPane",dijit.layout.ContentPane,{pauseRefresh:false,pauseMsg:"Event Updates Paused",pauseTitle:"Pause Refresh",resumeTitle:"Resume Refresh",constructor:function(){this.isRefreshing=false;this.hasPolicy=false;this.pauseRefresh=false;},refresh:function(_1,_2){var _3=_2||!_1;if(this.isRefreshing&&!_3){return;}if(_3&&this.hasPolicy){this.lastRoleStack=null;}this.isRefreshing=true;this.cancel();if(!this.containerNode||!_1){this._setContent(this.onDownloadStart(),true);}else{if(_2){this._setContent(this.onDownloadStart(),true);}}var _4=this;var _5={preventCache:(this.preventCache||this.refreshOnShow),url:this.href,content:{tzoffset:(new Date()).getTimezoneOffset()*-60},handleAs:"text"};if(dojo.isObject(this.ioArgs)){dojo.mixin(_5,this.ioArgs);}var _6=(this._xhrDfd=(this.ioMethod||nox.ext.apps.vmanui.xhrGet)(_5));if(this.doubleBufferCallback){_6.addCallback(dojo.hitch(this,"doubleBufferCallback"));}_6.addCallback(function(_7){if(_7==null){return;}try{_4._isDownloaded=true;_4._setContent(_7,false);_4.onDownloadEnd();}catch(err){_4._onError("Content",err);}delete _4._xhrDfd;return _7;});_6.addErrback(function(_8){if(!_6.canceled){_4._onError("Download",_8);}delete _4._xhrDfd;return _8;});_6.addBoth(dojo.hitch(this,"timeoutEndRefresh"));},needRefresh:function(){var _9=true;if(this.hasPolicy){_9=this.compareRoleStack();this.lastRoleStack=dojo.clone(this.pm.role_stack);}return _9;},compareRoleStack:function(){var _a=false;if(this.lastRoleStack==null){_a=true;}else{var _b=dojo.toJson(this.lastRoleStack);var _c=dojo.toJson(this.pm.role_stack);_a=(_b!=_c);}return _a;},timeoutEndRefresh:function(){setTimeout(dojo.hitch(this,"endRefresh"),nox.ext.apps.vmanui.main.TIMEOUT_MSEC/2);},endRefresh:function(){this.isRefreshing=false;}});}