/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.vmanui.ListEditor"]){dojo._hasResource["nox.ext.apps.vmanui.ListEditor"]=true;dojo.provide("nox.ext.apps.vmanui.ListEditor");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit.form.Button");dojo.declare("nox.ext.apps.vmanui.ListEditor",[dijit._Widget,dijit._Templated],{templateString:"<div class=\"list_editor\" style=\"text-align:left\">\n  <table dojoAttachPoint=\"tableNode\" class=\"list_editor_table\">\n    <tr>\n      <td>\n        <div dojoAttachPoint=\"emptyNode\" class=\"list_editor_empty\">\n          <div dojoAttachPoint=\"emptyTextRegular\" class=\"list_editor_empty_regular\">Click + to add an item to this list</div>\n          <div dojoAttachPoint=\"emptyTextReadOnly\" class=\"list_editor_empty_readonly\">There are no items in this list</div>\n        </div>\n        <div dojoAttachPoint=\"contentNode\" class=\"list_editor_contents\"></div>\n      </td>\n      <td rowspan=\"2\">\n        <div class=\"list_editor_controls\">\n          <button dojoType=\"dijit.form.Button\" class=\"blueButton\" dojoAttachPoint=\"save_button\">Save Target VLAN Changes</button>\n          <button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"reset_button\">Undo Changes</button>\n        </div>\n        <div dojoAttachPoint=\"infoNode\" class=\"list_editor_item_info\" style=\"display:none\"></div>\n        <div dojoAttachPoint=\"errorNode\" class=\"list_editor_error\"></div>\n      </td>\n    </tr>\n    <tr>\n      <td>\n        <div class=\"list_editor_item_controls\">\n          <button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"add_button\">+</button>\n          <button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"delete_button\">&minus;</button>\n        </div>\n      </td>\n    </tr>\n  </table>\n</div>\n",widgetsInTemplate:true,constructor:function(){this._items={};this._itemOrder=[];this._selected=[];this._animate=dojo.isIE?false:true;this._wrapperHeight="24";this._animDuration=500;this._animRate=50;this._readonly=false;this._handles=[];},postCreate:function(){dojo.style(this.contentNode,{display:"none"});dojo.style(this.emptyNode,{display:"block"});this.isEmpty=true;if(this._readonly){this.add_button.attr("disabled",true);this.delete_button.attr("disabled",true);this.save_button.attr("disabled",true);this.reset_button.attr("disabled",true);dojo.style(this.add_button.domNode,{"display":"none"});dojo.style(this.delete_button.domNode,{"display":"none"});dojo.style(this.save_button.domNode,{"display":"none"});dojo.style(this.reset_button.domNode,{"display":"none"});dojo.style(this.emptyTextReadOnly,{"display":"block"});dojo.style(this.emptyTextRegular,{"display":"none"});}else{var _1=dojo.connect(this.delete_button,"onClick",this,"deleteSelected");var _2=dojo.connect(this.add_button,"onClick",this,"createItem");var _3=dojo.connect(this.save_button,"onClick",this,"save");var _4=dojo.connect(this.reset_button,"onClick",this,"reset");this.delete_button.attr("disabled",true);var _5=dojo.connect(dojo.body(),"onclick",this,"clickOut");dojo.style(this.emptyTextReadOnly,{"display":"none"});dojo.style(this.emptyTextRegular,{"display":"block"});this._handles.push(_1,_2,_3,_4,_5);}},empty:function(_6){for(var _7 in this._items){this.removeItem(_7,_6);}},createItem:function(){if(this._readonly){return;}throw Error("createItem() must be implemented in a subclass");},itemWrapper:function(_8){var _9=this.itemWrapperId(_8);return dojo.byId(_9);},itemWrapperId:function(_a){return ["list_item_wrapper",this.id,_a].join("_");},wrapItem:function(_b,_c){var _d=dojo.doc.createElement("div");dojo.place(_b.domNode,_d,"only");dojo.addClass(_d,"list_editor_item");_d.id=this.itemWrapperId(_b.id);if(_c){dojo.addClass(_d,"list_editor_item_first");}if(this._animate){dojo.style(_d,{"height":"0px"});}if(!this._readonly){var _e=dojo.connect(_d,"onclick",this,"clickItem");var _f=dojo.connect(_d,"onmousedown",this,"mouseDownItem");var cxu=dojo.connect(_d,"onmouseup",this,"mouseUpItem");this._handles.push(_e,_f,cxu);}return _d;},itemOrder:function(){var _11=[];dojo.query(".list_editor_item",this.contentNode).forEach(function(_12){var _13=_12.id.replace("list_item_wrapper_"+this.id+"_","");_11.push(_13);},this);var _14={};dojo.forEach(_11,function(_15,i){_14[_15]=i;});return {asArray:_11,count:_11.length,index:_14};},deleteSelected:function(_17){if(this._readonly){return;}dojo.forEach(this._selected,function(sId){this.removeItem(sId);},this);dojo.stopEvent(_17);},clickOut:function(_19){var _1a=true;var _1b=_19.target;while(_1a&&_1b&&(_1b!=dojo.body())){if(_1b==this.tableNode){_1a=false;}_1b=_1b.parentNode;}if(_1a){this.unselectAll();}},unselectAll:function(){if(this._readonly){return;}if(this._selected.length){this.unselectItems(this._selected);}},unselectItems:function(_1c){if(this._readonly){return;}var _1d={};dojo.forEach(_1c,function(_1e){var _1f=this.itemWrapper(_1e);if(_1f){dojo.removeClass(_1f,"list_editor_item_selected");}_1d[_1e]=true;},this);var _20=dojo.filter(this._selected,function(sId){return (!_1d[sId]);});this._selected=_20;this._onSelectChange();},extendSelectedTo:function(_22){if(this._readonly){return;}var _23=this.itemOrder();var _24=0,_25=_23.count;dojo.forEach(this._selected,function(_26){_24=Math.max(_24,_23.index[_26]);_25=Math.min(_25,_23.index[_26]);});var _27=_23.index[_22];var _28=[];if(_27<_25){_28=_23.asArray.slice(_27,_25);}else{if(_27>_24){_28=_23.asArray.slice(_24+1,_27+1);}}this.selectItems(_28,true);},isSelected:function(sId){if(this._readonly){return false;}var bIs=false;dojo.forEach(this._selected,function(_2b){if(_2b==sId){bIs=true;}});return bIs;},selectItems:function(_2c,_2d){if(this._readonly){return;}if(!_2d){this.unselectAll();}dojo.forEach(_2c,function(sId){var _2f=this.itemWrapper(sId);dojo.addClass(_2f,"list_editor_item_selected");this._selected.push(sId);},this);this._onSelectChange();},mouseDownItem:function(_30){this._selectConnect=dojo.connect(dojo.body(),"onselectstart",dojo.stopEvent);},mouseUpItem:function(_31){if(this._selectConnect){dojo.disconnect(this._selectConnect);}},clickItem:function(_32){if(this._readonly){return;}if(this._selectConnect){dojo.disconnect(this._selectConnect);}var _33=_32.currentTarget.id.replace("list_item_wrapper_"+this.id+"_","");if(_32.metaKey||_32.altKey||_32.ctrlKey){if(this.isSelected(_33)){this.unselectItems([_33]);}else{this.selectItems([_33],true);}}else{if(_32.shiftKey){this.extendSelectedTo(_33);}else{this.selectItems([_33],false);}}dojo.stopEvent(_32);_32.preventDefault();},_onSelectChange:function(){if(this._readonly){return;}var _34={},_35=[];dojo.forEach(this._selected,function(sId){if(!_34[sId]){_35.push(sId);}_34[sId]=true;});this._selected=_35;var _37=(this._selected.length==0);if(this._selected.length==1){this._items[this._selected[0]].focus();}else{if(this._selected.length>1){for(var sId in this._items){var _39=this._items[sId];if(_39){_39.focusNode.blur();}}_37=false;}}if(this.delete_button.domNode){this.delete_button.attr("disabled",_37);}},itemCount:function(){var _3a=0;for(var id in this._items){_3a++;}return _3a;},getItem:function(_3c){if(dojo.isString(_3c)){sId=_3c;}else{sId=_3c.id;}return this._items[sId];},removeItem:function(_3d,_3e){var _3f=this.getItem(_3d);if(_3f){this.unselectItems([_3f.id]);delete this._items[_3f.id];var _40=this.itemWrapper(_3f.id);if(!_3e){this.__itemsChanged();}var cb=dojo.hitch(this,function(){this.contentNode.removeChild(_40);_3f.destroyRecursive();_3f=null;_40=null;});if(this._animate){dojo.animateProperty({node:_40,duration:this._animDuration,rate:this._animRate,onEnd:cb,properties:{"height":{start:this._wrapperHeight,end:"0"}}}).play();}else{cb();}}},addItem:function(_42){var id=_42.id;if(this._items[id]){this._items[id].destroy();this._items[id]=null;delete this._items[id];}var _44=(this.itemCount()==0);this._items[id]=_42;var _45=this.wrapItem(_42,_44);dojo.place(_45,this.contentNode,"last");if(this._animate){dojo.animateProperty({node:_45,duration:this._animDuration,rate:this._animRate,onEnd:function(){dojo.style(_45,{"height":""});},properties:{"height":{start:"0",end:this._wrapperHeight}}}).play();}this.__itemsChanged();},__itemsChanged:function(){var _46=this.itemCount()?false:true;if(_46!=this.isEmpty){this.isEmpty=_46;dojo.style(this.contentNode,{display:_46?"none":"block"});dojo.style(this.emptyNode,{display:_46?"block":"none"});}var _47=this.contentNode.childNodes;var _48=dojo.map(_47,function(_49){return _49.childNodes[0].id;});var _4a=[];for(var sId in this._items){_4a.push([sId,dojo.indexOf(_48,this._items[sId].domNode.id)]);}_4a=_4a.sort(function(_4c,_4d){return _4c[1]-_4d[1];});this._itemOrder=dojo.map(_4a,function(_4e){return _4e[0];});},reset:function(){},save:function(){},uninitialize:function(){dojo.forEach(this._handles,function(h){dojo.disconnect(h);});this._handles=[];for(var sId in this._items){this._items[sId].destroyRecursive();this._items[sId]=null;}this._items={};this._itemOrder=[];this._selected=[];this.inherited(arguments);}});}