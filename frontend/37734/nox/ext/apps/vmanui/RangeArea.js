/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.vmanui.RangeArea"]){dojo._hasResource["nox.ext.apps.vmanui.RangeArea"]=true;dojo.provide("nox.ext.apps.vmanui.RangeArea");dojo.require("dojox.charting.Chart2D");dojo.require("dojox.charting.widget.Legend");dojo.require("nox.ext.apps.vmanui.patches.dojo.gfx._base");(function(){var df=dojox.lang.functional,dc=dojox.charting.plot2d.common,_3=df.lambda("item.purgeGroup()");dojo.declare("nox.ext.apps.vmanui.RangeArea",dojox.charting.plot2d.Default,{calculateAxes:function(_4){var _5=dojo.clone(dc.defaultStats);var _6={};var i,j,s;for(var i=0,l=this.series.length;i<l;i++){s=this.series[i];for(j=0,jl=s.data.length;j<jl;j++){var _b=s.data[j];if(!_6[_b.x]){_6[_b.x]={min:0,max:0};}_5.hmin=Math.min(_5.hmin,_b.x);_5.hmax=Math.max(_5.hmax,_b.x);_6[_b.x].min+=_b.low;_6[_b.x].max+=_b.high;}}this._maxRunLength=_5.hmax;for(var x in _6){_5.vmin=Math.min(_5.vmin,_6[x].min);_5.vmax=Math.max(_5.vmax,_6[x].max);}this._calc(_4,_5);return this;},render:function(_d,_e){var i;if(this._maxRunLength<=0){return this;}if(this.opt.tension&&isNaN(this.opt.tension)){this.opt.tension=2.5;}var _10={};for(i=0;i<this.series.length;i++){for(j=0;j<this.series[i].data.length;j++){if(!_10[this.series[i].data[j].x]){_10[this.series[i].data[j].x]={high:0,low:0};}var _11=this.series[i].data[j];_10[_11.x].high+=_11.high;_10[_11.x].low+=_11.low;}}var _12=[];for(var p in _10){_12.push(p);}_12.sort();var _14=dojo.map(_12,function(_15){return _10[_15].high;});var _16=dojo.map(_12,function(_17){return _10[_17].low;});this.dirty=this.isDirty();if(this.dirty){dojo.forEach(this.series,_3);this.cleanGroup();s=this.group;df.forEachRev(this.series,function(_18){_18.cleanGroup(s);});}var _19,_1a,_1b,_1c;var t=this.chart.theme,_1e=this.events(),ht=this._hScaler.scaler.getTransformerFromModel(this._hScaler),vt=this._vScaler.scaler.getTransformerFromModel(this._vScaler);this.resetEvents();for(i=this.series.length-1;i>=0;--i){var run=this.series[i];if(!this.dirty&&!run.dirty){continue;}run.cleanGroup();s=run.group;var _22=dojo.map(_14,function(v,idx){return {x:ht(_12[idx])+_e.l,y:_d.height-_e.b-vt(v)};}),_25=dojo.map(_16,function(v,idx){return {x:ht(_12[idx])+_e.l,y:_d.height-_e.b-vt(v)};});if(_14.length&&_14[0]!=0){_22.splice(0,0,{x:ht(_12[0])+_e.l,y:_d.height-_e.b-vt(0)});}if(_16.length&&_16[0]!=0){_25.splice(0,0,{x:ht(_12[0])+_e.l,y:_d.height-_e.b-vt(0)});}if(_14.length&&_14[_14.length-1]!=0){_22.push({x:ht(_12[_12.length-1])+_e.l,y:_d.height-_e.b-vt(0)});}if(_16.length&&_16[_16.length-1]!=0){_25.push({x:ht(_12[_12.length-1])+_e.l,y:_d.height-_e.b-vt(0)});}if(!run.fill||!run.stroke){_1b=new dojo.Color(t.next("color"));}var _28=this.opt.tension?dc.curve(_22,this.opt.tension):"",_29=this.opt.tension?dc.curve(_25,this.opt.tension):"";var _2a=dojo.clone(_22),_2b=dojo.clone(_25);var _2c=run.fill?run.fill:dc.augmentFill(t.series.fill,_1b);if(this.opt.tension){var pp=dc.curve(_2a,this.opt.tension)+"L"+dc.curve(_25,this.opt.tension).substr(1)+"Z";run.dyn.fill=s.createPath(pp).setFill(_2c).getFill();}else{_2a=_2a.concat(_2b);_2a.push(_22[0]);run.dyn.fill=s.createPolyline(_2a).setFill(_2c).getFill();}if(this.opt.lines||this.opt.markers){_19=run.stroke?dc.makeStroke(run.stroke):dc.augmentStroke(t.series.stroke,_1b);if(false&&(run.outline||t.series.outline)){_1a=dc.makeStroke(run.outline?run.outline:t.series.outline);_1a.width=2*_1a.width+_19.width;}}if(this.opt.markers){_1c=run.dyn.marker=run.marker?run.marker:t.next("marker");}var _2e,_2f,_30;if(this.opt.shadows&&_19){var sh=this.opt.shadows,_32=new dojo.Color([0,0,0,0.3]),_33=dojo.map(_22,function(c){return {x:c.x+sh.dx,y:c.y+sh.dy};}),_35=dojo.clone(_1a?_1a:_19);_35.color=_32;_35.width+=sh.dw?sh.dw:0;if(this.opt.lines){if(this.opt.tension){run.dyn.shadow=s.createPath(dc.curve(_33,this.opt.tension)).setStroke(_35).getStroke();}else{run.dyn.shadow=s.createPolyline(_33).setStroke(_35).getStroke();}}if(this.opt.markers){_30=dojo.map(_33,function(c){return s.createPath("M"+c.x+" "+c.y+" "+_1c).setStroke(_35).setFill(_32);},this);}}if(this.opt.lines){if(false&&_1a){if(this.opt.tension){run.dyn.outline=s.createPath(_28).setStroke(_1a).getStroke();}else{run.dyn.outline=s.createPolyline(_22).setStroke(_1a).getStroke();}}if(this.opt.tension){run.dyn.stroke=s.createPath(_28).setStroke(_19).getStroke();}else{run.dyn.stroke=s.createPolyline(_22).setStroke(_19).getStroke();}}if(this.opt.markers){_2e=new Array(_22.length);_2f=new Array(_22.length);dojo.forEach(_22,function(c,i){var _39="M"+c.x+" "+c.y+" "+_1c;if(false&&_1a){_2f[i]=s.createPath(_39).setStroke(_1a);}_2e[i]=s.createPath(_39).setStroke(_19).setFill(_19.color);},this);if(_1e){dojo.forEach(_2e,function(s,i){var o={element:"marker",index:i,run:run,plot:this,hAxis:this.hAxis||null,vAxis:this.vAxis||null,shape:s,outline:_2f[i]||null,shadow:_30&&_30[i]||null,cx:_22[i].x,cy:_22[i].y,x:i+1,y:run.data[i]};this._connectEvents(s,o);},this);}}run.dirty=false;for(j=0;j<run.data.length;j++){var v=run.data[j];_10[v.x].high-=v.high;_10[v.x].low-=v.low;_14=dojo.map(_12,function(_3e){return _10[_3e].high;});_16=dojo.map(_12,function(_3f){return _10[_3f].low;});}}this.dirty=false;return this;}});dojo.declare("nox.ext.apps.vmanui.RangeAreaVerticalAxis",dojox.charting.axis2d.Default,{getOffsets:function(){var _40=this.inherited(arguments);_40.l=Math.max(_40.l,60);return _40;},scale:function(num){if(num){var abs=Math.abs(num);var neg=num/abs;var _44=Math.ceil(Math.log(abs)/Math.LN10);var _45=Math.pow(10,_44);var _46=abs/_45;if(_46>0.8){return _45*neg;}}return num;},calculate:function(min,max,_49,_4a){this._min=min;this._max=max;min=this.scale(min);max=this.scale(max);return this.inherited(arguments,[min,max,_49,_4a]);},render:function(dim,_4c){var _4d=this.dirty;this.inherited(arguments);if(_4d){try{var dc=dojox.charting,_4f=dc.axis2d.common,s=this.group,g=dojox.gfx,lin=dc.scaler.linear;var ta=this.chart.theme.axis,_54="stroke" in this.opt?this.opt.stroke:ta.stroke,_55="majorTick" in this.opt?this.opt.majorTick:ta.majorTick,_56="minorTick" in this.opt?this.opt.minorTick:ta.minorTick,_57="microTick" in this.opt?this.opt.microTick:ta.minorTick,_58="font" in this.opt?this.opt.font:ta.font,_59="fontColor" in this.opt?this.opt.fontColor:ta.fontColor,_5a=Math.max(_55.length,_56.length),_5b=_58?g.normalizedLength(g.splitFontString(_58).size):0,_5c=dojox.gfx.renderer=="canvas",_5d=_5c||this.opt.htmlLabels&&!dojo.isIE&&!dojo.isOpera?"html":"gfx";if(this.vertical&&this.ticks){var _5e={x:-1,y:0};var _5a=Math.max(_55.length,_56.length);var _5f=4;var _60={x:_5e.x*(_5a+_5f),y:_5b*0.4};if(this._min<0){var _61=_4f.createText[_5d](this.chart,s,_4c.l+4*_60.x,dim.height-30+_60.y,"end","Outbound",_58,_59);if(_5d=="html"){this.htmlElements.push(_61);}}if(this._max>0){var _62=_4f.createText[_5d](this.chart,s,_4c.l+4*_60.x,7+_60.y,"end","Inbound",_58,_59);if(_5d=="html"){this.htmlElements.push(_62);}}}}catch(e){console.log(e);}}return this;}});dojo.declare("nox.ext.apps.vmanui.DashboardRangeAreaVerticalAxis",nox.ext.apps.vmanui.RangeAreaVerticalAxis,{scale:function(num){if(num){var abs=Math.abs(num);var neg=num/abs;var _66=Math.ceil(Math.log(abs)/Math.LN10);var _67=Math.pow(10,_66);return _67*neg;}return num;}});})();}