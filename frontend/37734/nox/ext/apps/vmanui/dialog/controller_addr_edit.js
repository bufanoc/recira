/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.vmanui.dialog.controller_addr_edit"]){dojo._hasResource["nox.ext.apps.vmanui.dialog.controller_addr_edit"]=true;dojo.provide("nox.ext.apps.vmanui.dialog.controller_addr_edit");dojo.require("nox.ext.apps.vmanui.BoundedDialog");dojo.declare("nox.ext.apps.vmanui.dialog.controller_addr_edit",[dijit._Widget,dijit._Templated],{popup:null,widgetsInTemplate:true,addr_obj:null,templateString:"\n<div>\n  <form dojoType=\"dijit.form.Form\" dojoAttachEvent=\"onSubmit:formSubmit\">\n\n<table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" class=\"TableFirewallPolicy\" style=\"background: none; border: none;\">\n  <tr>\n    <td colspan=\"2\"><input dojoType=\"dijit.form.RadioButton\" name=\"dhcp_enabled\"\n        dojoAttachPoint=\"dhcp_yes_radio\" type=\"radio\"\n        dojoAttachEvent=\"onChange:_sync_to_radio\"\n        /> Use DHCP\n    </td>\n  </tr>\n</table>\n<div id=\"dhcp_message\" class=\"hint hidden\">\nDHCP is not available on this controller because at least one of the resource pools is configured to use\n'fail-safe' mode, which is incompatible with DHCP.\n</div>\n\n<table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" class=\"TableFirewallPolicy\" style=\"background: none; border: none;\">\n  <tr>\n    <td colspan=\"2\"><input dojoType=\"dijit.form.RadioButton\" name=\"dhcp_enabled\"\n        dojoAttachPoint=\"dhcp_no_radio\" type=\"radio\"\n        dojoAttachEvent=\"onChange:_sync_to_radio\"\n        /> Manual Configuration\n    </td>\n  </tr>\n  <tr>\n    <td><label>IP Address:</label></td>\n    <td><input dojoType=\"nox.ext.apps.vmanui.regex.IPv4TextBox\"\n              dojoAttachPoint=\"address_text\" type=\"text\"\n              required=\"true\" style=\"padding: 0;\"\n              dojoAttachEvent=\"onKeyUp:_check_submit_enabled\"/></td>\n  </tr>\n  <tr>\n    <td><label>Netmask:</label></td>\n    <td><input dojoType=\"nox.ext.apps.vmanui.regex.IPv4Netmask\"\n              dojoAttachPoint=\"netmask_text\" type=\"text\"\n              required=\"true\" style=\"padding: 0;\"\n              dojoAttachEvent=\"onKeyUp:_check_submit_enabled\"/></td>\n  </tr>\n  <tr>\n    <td><label>Gateway:</label></td>\n    <td><input dojoType=\"nox.ext.apps.vmanui.regex.IPv4TextBox\"\n              dojoAttachPoint=\"gateway_text\" type=\"text\"\n              required=\"false\" style=\"padding: 0;\"\n              dojoAttachEvent=\"onKeyUp:_check_submit_enabled\"/></td>\n  </tr>\n  <tr>\n    <td style=\"vertical-align:top;padding-top:10px;white-space:nowrap\"><label>DNS Servers:</label></td>\n    <td>\n      <input dojoType=\"nox.ext.apps.vmanui.regex.IPv4TextBox\"\n            dojoAttachPoint=\"dns-nameserver0_text\" type=\"text\"\n            required=\"false\" style=\"padding: 0;\"\n            dojoAttachEvent=\"onKeyUp:_check_submit_enabled\"/>\n      <br/>\n      <input dojoType=\"nox.ext.apps.vmanui.regex.IPv4TextBox\"\n           dojoAttachPoint=\"dns-nameserver1_text\" type=\"text\"\n           required=\"false\" style=\"padding: 0;\"\n           dojoAttachEvent=\"onKeyUp:_check_submit_enabled\"/>\n    </td>\n  </tr>\n  <tr>\n    <td><label>Search Domain:</label></td>\n    <td><input dojoType=\"nox.ext.apps.vmanui.regex.DNSSearchTextBox\"\n              dojoAttachPoint=\"dns-search_text\" style=\"padding: 0;\"\n              dojoAttachEvent=\"onKeyUp:_check_submit_enabled\"/></td>\n  </tr>\n</table>\n\n<div class=\"dialogButtonContainer\">\n  <button class=\"blueButton\" dojoType=\"dijit.form.Button\"\n    dojoAttachPoint=\"submit_button\" disabled=\"true\" type=\"submit\">\n    Make Changes </button>\n  <button dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:onCancel\">Cancel\n  </button>\n</div>\n\n  </form>\n</div>\n",field_names:["address_text","netmask_text","gateway_text","dns-search_text","dns-nameserver0_text","dns-nameserver1_text","dhcp_yes_radio","dhcp_no_radio"],array_fields:{"dns-nameserver0_text":"dns-nameservers","dns-nameserver1_text":"dns-nameservers"},postMixInProperties:function(){this.inherited(arguments);this.popup=new nox.ext.apps.vmanui.BoundedDialog({});dojo.connect(this.popup,"onCancel",this,"onCancel");this.popup.attr("title","Controller IP Address Settings");},fillFields:function(_1){if(_1=="fail_safe"){this.dhcp_yes_radio.setAttribute("disabled","true");this.dhcp_no_radio.setAttribute("disabled","true");dojo.removeClass("dhcp_message","hidden");}else{dojo.addClass("dhcp_message","hidden");}if(this.addr_obj.dhcp){this.dhcp_yes_radio.setValue(true);}else{this.dhcp_no_radio.setValue(true);dojo.forEach(this.field_names,function(f){if(this.array_fields[f]){return;}var _3=f.split("_");if(_3[1]=="text"&&this.addr_obj[_3[0]]){this[f].setValue(this.addr_obj[_3[0]]);}},this);if(dojo.isArray(this.addr_obj["dns-nameservers"])){dojo.forEach(this.addr_obj["dns-nameservers"],function(_4,i){this["dns-nameserver"+i+"_text"].setValue(_4);},this);}}},_sync_to_radio:function(){var _6=this.dhcp_yes_radio.getValue();dojo.forEach(this.field_names,function(f){var _8=f.split("_");if(_8[1]=="text"){if(_6){this[f].setValue("");}this[f].attr("disabled",_6);}},this);this._check_submit_enabled();},_check_submit_enabled:function(){var _9=true;if(this.dhcp_no_radio.getValue()){for(var i=0;i<this.field_names.length;i++){var f=this.field_names[i];if(this[f].isValid&&!this[f].isValid()){_9=false;break;}}}this.submit_button.attr("disabled",!_9);},show:function(){nox.ext.apps.vmanui.vac_status.find_fail_mode("all",dojo.hitch(this,this.fillFields));this._sync_to_radio();this.submit_button.attr("disabled",true);this.popup.attr("content",this.domNode);dojo.addClass(this.popup.domNode,"controllerAddrEditDialog");nox.ext.apps.vmanui.main.onDialogOpen();this.popup.show();},hide:function(){nox.ext.apps.vmanui.main.onDialogClose();this.popup.destroy();this.destroy();},onCancel:function(){this.hide();},isValid:function(){if(this.dhcp_yes_radio.getValue()){return true;}for(var i=0;i<this.field_names.length;i++){var f=this.field_names[i];if(this[f].isValid&&!this[f].isValid()){this[f].focus();return false;}}return true;},formSubmit:function(_e){dojo.stopEvent(_e);this.onSubmit();},onSubmit:function(){if(!this.isValid()){return;}var _f={"name":this.addr_obj.name};if(this.dhcp_yes_radio.getValue()){_f.dhcp=true;}else{_f.dhcp=false;dojo.forEach(this.field_names,function(f){var arr=f.split("_");if(this.array_fields[f]){return;}if(arr[1]=="text"){var v=this[f].getValue();if(v.length>0){_f[arr[0]]=v;}}},this);for(var f in this.array_fields){var arr=f.split("_");var k=this.array_fields[f];if(arr[1]=="text"){var v=this[f].getValue();if(v.length){if(_f[k]==undefined){_f[k]=[];}_f[k].push(v);}}}}this.onSave(_f);this.hide();},onSave:function(_17){}});}