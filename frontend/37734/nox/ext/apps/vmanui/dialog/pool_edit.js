/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.vmanui.dialog.pool_edit"]){dojo._hasResource["nox.ext.apps.vmanui.dialog.pool_edit"]=true;dojo.provide("nox.ext.apps.vmanui.dialog.pool_edit");dojo.require("nox.ext.apps.vmanui.BoundedDialog");dojo.declare("nox.ext.apps.vmanui.dialog.pool_edit",[dijit._Widget,dojox.dtl._Templated],{popup:null,widgetsInTemplate:true,error_str:null,pool_obj:null,templateString:"\n<div>\n{% if has_error %}\n  <div class=\"poolConnectError\">Connection Error : {{ error_str }}</div>\n{% endif %}\n  <form dojoType=\"dijit.form.Form\" dojoAttachEvent=\"onSubmit:formSubmit\">\n    <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" class=\"TableFirewallPolicy\" style=\"background: none; border: none;\">\n      <tr>\n        <td style=\"text-align:right\"><label class=\"nowrap\">Pool Master Server (DNS/IP):</label></td>\n        <td><input dojoType=\"nox.ext.apps.vmanui.regex.HostTextBox\"\n          dojoAttachPoint=\"master_addr_text\" type=\"text\" style=\"padding: 0;\"\n          dojoAttachEvent=\"onKeyUp:_check_submit_enabled\"/></td>\n      </tr>\n\n      <tr>\n        <td style=\"text-align:right\"><label class=\"nowrap\">Login Username:</label></td>\n        <td><input dojoType=\"dijit.form.ValidationTextBox\"\n                  dojoAttachPoint=\"username_text\" type=\"text\"\n                  value=\"root\" required=\"true\" style=\"padding: 0;\"\n                  dojoAttachEvent=\"onKeyUp:_check_submit_enabled\"/></td>\n      </tr>\n\n      <tr>\n        <td style=\"text-align:right\"><label class=\"nowrap\">Login Password:</label></td>\n        <td><input dojoType=\"dijit.form.ValidationTextBox\" dojoAttachPoint=\"password_text\"\n          type=\"password\" required=\"true\" style=\"padding: 0;\"\n          dojoAttachEvent=\"onKeyUp:_check_submit_enabled\"/></td>\n      </tr>\n\n      <tr class=\"steal_pool_row\">\n        <td style=\"text-align:right;vertical-align:top;padding-top:10px\"><label>Steal:</label></td>\n        <td style=\"width:200px\">\n          <input dojoType=\"dijit.form.CheckBox\" dojoAttachPoint=\"steal_checkbox\" style=\"margin:0px;margin-right:3px;float:left\" />\n          <span style=\"font-size:85%;color:#4C4C4C\">If checked, forcibly replaces any existing controller.</span>\n        </td>\n      </tr>\n\n    </table>\n    <div class=\"dialogButtonContainer\">\n      <button class=\"blueButton\" dojoType=\"dijit.form.Button\"\n        dojoAttachPoint=\"submit_button\" type=\"submit\" >Connect</button>\n      <button dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:onCancel\">Cancel</button>\n    </div>\n  </form>\n</div>\n",field_names:["master_addr_text","username_text","password_text"],postMixInProperties:function(){this.inherited(arguments);this.is_new=this.pool_obj===null;this.has_error=this.error_str!==null;this.popup=new nox.ext.apps.vmanui.BoundedDialog({});this.can_steal=false;dojo.connect(this.popup,"onCancel",this,"onCancel");if(this.is_new){this.popup.attr("title","Add Resource Pool");}else{this.popup.attr("title","Modify Resource Pool");}if(this.is_new||(this.pool_obj&&this.pool_obj.xapi_status==10)){this.can_steal=true;}},postCreate:function(){var _1=dojo.query("tr.steal_pool_row",this.domNode)[0];dojo.removeClass(_1,"hidden");this.steal_checkbox.attr("disabled",false);if(!this.can_steal){dojo.addClass(_1,"hidden");this.steal_checkbox.attr("disabled",true);}},fillFields:function(){var ip="";var _3="root";var _4="";var _5=false;if(!this.is_new){dojo.forEach(this.pool_obj.properties,function(_6){if(_6[0]=="master_address_1"){ip=_6[1];}else{if(_6[0]=="password"){_4=_6[1];}else{if(_6[0]=="username"){_3=_6[1];}else{if(_6[0]=="steal_pool"){_5=_6[1]=="true";}}}}});}this.username_text.setValue(_3);this.master_addr_text.setValue(ip);this.password_text.setValue(_4);this.steal_checkbox.attr("checked",_5);this._check_submit_enabled();},_check_submit_enabled:function(){var _7=true;for(var i=0;i<this.field_names.length;i++){var f=this.field_names[i];if(!this[f].isValid()||this[f].getValue().length<1){_7=false;break;}}this.submit_button.attr("disabled",!_7);},show:function(){this.fillFields();this.popup.attr("content",this.domNode);dojo.addClass(this.popup.domNode,"poolEditDialog");nox.ext.apps.vmanui.main.onDialogOpen();this.popup.show();},hide:function(){nox.ext.apps.vmanui.main.onDialogClose();this.popup.destroy();this.destroy();},onCancel:function(){this.hide();},isValid:function(){for(var i=0;i<this.field_names.length;i++){var f=this.field_names[i];if(!this[f].isValid()){this[f].focus();return false;}}return true;},formSubmit:function(_c){dojo.stopEvent(_c);this.onSubmit();},onSubmit:function(){if(!this.isValid()){return;}if(this.is_new){var _d=nox.ext.apps.vmanui.vac_status.add_pool(this.master_addr_text.getValue(),this.username_text.getValue(),this.password_text.getValue(),this.steal_checkbox.checked);_d.addCallback(nox.ext.apps.vmanui.vac_status.show_connect_status_dialog);}else{this.pool_obj.properties=[["master_address_1",this.master_addr_text.getValue()],["username",this.username_text.getValue()],["password",this.password_text.getValue()]];if(this.can_steal){var _e=this.steal_checkbox.checked?"true":"false";this.pool_obj.properties.push(["steal_pool",_e]);}var d=nox.ext.apps.vmanui.vac_status.modify_pool(this.pool_obj);d.addCallback(nox.ext.apps.vmanui.vac_status.show_connect_status_dialog);}this.hide();}});}