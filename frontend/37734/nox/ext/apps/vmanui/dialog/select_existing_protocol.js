/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

if(!dojo._hasResource["nox.ext.apps.vmanui.dialog.select_existing_protocol"]){dojo._hasResource["nox.ext.apps.vmanui.dialog.select_existing_protocol"]=true;dojo.provide("nox.ext.apps.vmanui.dialog.select_existing_protocol");dojo.require("nox.ext.apps.vmanui.BoundedDialog");dojo.declare("nox.ext.apps.vmanui.dialog.select_existing_protocol",[dijit._Widget,dojox.dtl._Templated],{popup:null,widgetsInTemplate:true,acl_widget:null,empty_str:"",_skipNodeCache:false,templateString:"<div> \n<table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" class=\"TableFirewallPolicy\">\n    <tr>\n\t<td><div dojoAttachPoint=\"protocol_box\"></div></td>\n    <td class=\"dialogButtonContainer\"> \n      <button class=\"blueButton\" dojoType=\"dijit.form.Button\" \n        disabled=\"true\" dojoAttachPoint=\"use_proto_btn\"\n        dojoAttachEvent=\"onClick:onSubmit\">\n        Use Protocol \n      </button>\n      <button dojoType=\"dijit.form.Button\" \n          dojoAttachPoint=\"cancel_btn\"\n          dojoAttachEvent=\"onClick:onCancel\">\n          Cancel\n        </button>\n    </td>\n    </tr>\n    <tr><td> \n        <a dojoAttachPoint=\"view_details_link\"> </a>\n    </td>\n\t</tr>\n    <tr>\n\t</tr>\n  </table> \n  <span dojoAttachPoint=\"proto_modify\" \n        dojoAttachEvent=\"onSave:onProtoSave\"\n        dojoType=\"nox.ext.apps.vmanui.protocol_modify\"\n        is_standalone=\"false\"> \n  </span> {{ empty_str }}\n</div> \n",postMixInProperties:function(){this.inherited(arguments);this.popup=new nox.ext.apps.vmanui.BoundedDialog({});dojo.connect(this.popup,"onCancel",this,"onCancel");this.popup.attr("title","Select an Existing Protocol");},_initialize_filtering_select:function(){if(this._proto_fs){this._proto_fs.destroyRecursive();}var pm=this.acl_widget.role_widget.policy_manager;dojo.empty(this.protocol_box);this._proto_fs=new dijit.form.FilteringSelect({store:pm.getProtocolStore()});var _2=dojo.hitch(this,function(){this.use_proto_btn.attr("disabled",!this._proto_fs.isValid());var st=(this._proto_fs.isValid())?"block":"none";dojo.style(this.view_details_link,"display",st);});dojo.connect(this._proto_fs,"onChange",_2);_2();dojo.place(this._proto_fs.domNode,this.protocol_box);var _4=pm.getProtocol(this.acl_widget.acl.protocol_uid);if(_4!==undefined&&_4.name!==null){this._proto_fs.setDisplayedValue(_4.name);}this.toggle_details(false);},startup:function(){this.proto_modify.policy_manager=this.acl_widget.role_widget.policy_manager;this.proto_modify.acl_widget=this.acl_widget;this._initialize_filtering_select();dojo.connect(this.proto_modify,"onModify",this,"_refresh_protocol_dialog");dojo.connect(this.proto_modify,"onDelete",this,"_refresh_protocol_dialog",null);dojo.connect(this.view_details_link,"onclick",dojo.hitch(this,function(){this.toggle_details();}));},show:function(){this.popup.attr("content",this.domNode);dojo.addClass(this.popup.domNode,"selectProtocolDialog");nox.ext.apps.vmanui.main.onDialogOpen();this.popup.show();this.popup.refocus=false;},_destroyChildWidgets:function(){this.proto_modify.destroyRecursive();if(this._proto_fs){this._proto_fs.destroyRecursive();}this.use_proto_btn.destroyRecursive();this.cancel_btn.destroyRecursive();},hide:function(){this._destroyChildWidgets();nox.ext.apps.vmanui.main.onDialogClose();this.popup.destroy();this.destroyRecursive();},onCancel:function(){this.hide();},onSubmit:function(){var _5=nox.ext.apps.vmanui.menu_creator.creator;var _6=this._proto_fs.getValue();_5.change_protocol_for_acl(_6,this.acl_widget);this.hide();},toggle_details:function(_7){var _8=this.proto_modify;if(_7===undefined){_7=(dojo.style(_8.domNode,"display")=="none");}var _9,_a;if(!_7){_9="none";_a="view protocol details";this._proto_fs.attr("disabled",false);}else{var pm=this.acl_widget.role_widget.policy_manager;var _c=this._proto_fs.getValue();_8.showProtocol(pm.getProtocol(_c));_9="block";_a="hide protocol details";this._proto_fs.attr("disabled",true);}dojo.style(_8.domNode,{"display":_9});this.view_details_link.innerHTML=_a;},_refresh_protocol_dialog:function(_d){this._initialize_filtering_select();if(_d){var pm=this.acl_widget.role_widget.policy_manager;var _f=pm.getProtocol(_d);this._proto_fs.setDisplayedValue(_f.name);}},onProtoSave:function(){dojo.style(this.proto_modify.domNode,"display","none");}});}