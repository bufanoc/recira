/* Copyright (c) 2008, 2009, 2010 Nicira, Inc. */

dojo.require("nox.ext.apps.commonui.coreui.base");var coreui=nox.ext.apps.commonui.coreui;function set_response_headers(_1){var _2=dijit.byId("response_headers");_2.setValue(_1);};function set_response_body(_3,_4){var _5=dijit.byId("response_body");var t=_4;if(_3=="application/json"){dojo.toJsonIndentStr="  ";j=dojo.fromJson(t);t=dojo.toJson(j,true);}if(_3!="text/html"){t="<pre>"+t.replace(/[<>&]/g,function(s){if(s=="<"){return "&lt;";}else{if(s==">"){return "&gt;";}else{if(s=="&"){return "&amp;";}else{return s;}}}})+"</pre>";}else{t=t.replace(/^.*<body>([\s\S]*)<\/body>/i,"$1");t=t.replace(/<style(>|\s[^>]*>)[\s\S]*?<\/style>/ig,"");}_5.setContent(t);};function clear_response_data(){set_response_headers("");set_response_body("text/plain","");};function request_ok(_8,_9){var _a=_9.xhr.status+" "+_9.xhr.statusText;coreui.base.update_status_msg(_a,"successmsg");set_response_headers(_9.xhr.getAllResponseHeaders());set_response_body(_9.xhr.getResponseHeader("content-type"),_9.xhr.responseText);coreui.base.update_status_msg("Request completed successfully.","successmsg");};function request_err(_b,_c){var _d=_c.xhr.status+" "+_c.xhr.statusText;coreui.base.update_status_msg(_d,"errormsg");set_response_headers(_c.xhr.getAllResponseHeaders());set_response_body(_c.xhr.getResponseHeader("content-type"),_c.xhr.responseText);};function submit_request(){coreui.base.update_status_msg("Preparing request...","normalmsg");clear_response_data();var _e=dijit.byId("request_method_and_path").getValue();var m=_e.match(/^\s*(\S+)\s+(\S.*)$/);if(m===null){coreui.base.update_status_msg("Valid request method & uri not found.  Request aborted.","errormsg");return;}var _10=m[1].toUpperCase();var _11=m[2];var _12=dijit.byId("request_content_type").getValue();var _13=dijit.byId("request_body").getValue();coreui.base.update_status_msg("Submitted request, waiting for response...","normalmsg");if(_10=="PUT"){dojo.rawXhrPut({url:_11,headers:{"content-type":_12},putData:_13,timeout:5000,load:request_ok,error:request_err});}else{if(_10=="POST"){dojo.rawXhrPost({url:_11,headers:{"content-type":_12},postData:_13,timeout:5000,load:request_ok,error:request_err});}else{dojo.xhr(_10,{url:_11,timeout:5000,load:request_ok,error:request_err},false);}}};function keypress_handler(evt){if(evt.keyCode==dojo.keys.ENTER){submit_request();}};function attach_keypress_handler(){var _15=[dojo.byId("request_method_and_path"),dojo.byId("request_content_type")];for(var n in _15){dojo.connect(_15[n],"onkeypress",keypress_handler);}};